.panel.panel-info(ng-controller="CardCtrl" ng-init="init(item)")

  .panel-heading
    %h3.panel-title
      %span.right
        %a.glyphicon.glyphicon-refresh(ng-click="refresh()")
        %a.glyphicon.glyphicon-pencil(ng-click="edit()")
        %a.glyphicon.glyphicon-remove(ng-click="removeCard(item)")
      {{item._label}}

  .panel-body
    %dl.dl-horizontal
      - model_config.flat_fields.each do |name, options|
        %dt= options[:alias] || readable_method_name(name)
        - if options[:editable]
          %dd.editable(ng-click="edit('#{name}', #{options[:editable].to_json})")
            %i.glyphicon.glyphicon-pencil.edit-icon
            %dh-field(model=@model item="item" name=name)
        - else
          %dd
            %dh-field(model=@model item="item" name=name)

  - model_config.table_fields.each do |name, options|
    -# FIXME just export all this type info to the client
    - nested_model = Deckhand.config.model_storage.relation_class_name(@model, name)

    %h4.table-title(ng-click="toggleTable('#{name}')")
      %span.glyphicon.glyphicon-chevron-down(ng-class="{collapsed: collapse['#{name}']}")
      = options[:alias] || readable_method_name(name)
      %span(ng-show="!lazyLoad['#{name}']") ({{item.#{name}.length}})

    %div(collapse="collapse['#{name}']")
      %table.table
        %thead
          %tr
            %th &nbsp;
            - options[:table].each do |column|
              %th= readable_method_name column
        %tbody
          %tr(ng-repeat="nested_item in item.#{name}")
            %td
              %a.glyphicon.glyphicon-new-window(ng-click="showCard(nested_item._model, nested_item.id)")
            - options[:table].each_with_index do |column, i|
              %td
                %dh-field(model=nested_model item="nested_item" name=column)

  - if model_config.actions.any?
    .panel-footer
      - model_config.actions.each do |name, options|
        %button.btn.btn-default(ng-click="act(item, '#{name}', #{options.to_json})" ng-show="#{show_action?(options[:if])}")
          = options[:alias] || readable_method_name(name)
