.panel.panel-info(ng-controller="CardCtrl")

  .panel-heading
    %h3.panel-title
      %span.right
        %a.glyphicon.glyphicon-refresh(ng-click="refresh()")
        - if model_config.has_history?
          %a.glyphicon.glyphicon-book(ng-click="showHistory()")
        %a.glyphicon.glyphicon-pencil(ng-click="edit()")
        %a.glyphicon.glyphicon-remove(ng-click="removeCard(item)")
      {{item._label}}

  .panel-body
    %dl.dl-horizontal
      - model_config.flat_fields.each do |name, options|
        %dt= options[:alias] || readable_method_name(name)
        - if options[:editable]
          %dd.editable(ng-click="edit('#{name}', #{options[:editable].to_json})")
            %i.glyphicon.glyphicon-pencil.edit-icon
            = angular_binding 'item', name, options
        - else
          %dd= angular_binding 'item', name, options

  - model_config.table_fields.each do |name, options|
    %table.table(ng-show="item.#{name}.length > 0")
      %thead
        %tr
          %th(colspan="#{options[:table].size}")
            %h4
              = readable_method_name name
              ({{item.#{name}.length}})
        %tr
          - options[:table].each do |column|
            %th= readable_method_name column
      %tbody
        %tr(ng-repeat="nested_item in item.#{name}")
          - options[:table].each_with_index do |column, i|
            %td= angular_binding 'nested_item', column, link_to_item: i == 0

  .panel-footer
    - model_config.actions.each do |name, options|
      %button.btn.btn-default(ng-click="act(item, '#{name}', #{options.to_json})" ng-show="#{show_action?(options[:if])}")
        = options[:alias] || readable_method_name(name)
